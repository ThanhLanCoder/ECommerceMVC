@model IEnumerable<ECommerceMVC.Models.ViewModels.CartItemVM>

@{
    ViewData["Title"] = "Thanh Toán";
}

<div class="container-fluid py-5">
    <div class="container py-5">
        <h1 class="mb-4">Billing details</h1>
        <form id="checkoutForm" method="post" asp-controller="ThanhToan">
            <div class="row g-5">
                <!-- Thông tin khách hàng -->
                <div class="col-md-12 col-lg-6 col-xl-7">
                    <div class="form-item mb-3">
                        <label class="form-label my-2">Họ và tên <sup>*</sup></label>
                        <input type="text" name="HoTen" class="form-control" required>
                    </div>

                    <div class="form-item mb-3">
                        <label class="form-label my-2">Số điện thoại <sup>*</sup></label>
                        <input type="tel" name="SoDienThoai" class="form-control" required>
                    </div>

                    <div class="form-item mb-3">
                        <label class="form-label my-2">Địa chỉ giao hàng <sup>*</sup></label>
                        <input type="text" name="DiaChi" class="form-control" required placeholder="Số nhà, đường, phường/xã, quận/huyện, tỉnh/thành">
                    </div>

                    <div class="form-item mb-3">
                        <label class="form-label my-2">Ghi chú (không bắt buộc)</label>
                        <textarea name="GhiChu" class="form-control" rows="4" placeholder="Ghi chú cho đơn hàng (nếu có)"></textarea>
                    </div>
                </div>

                <!-- Giỏ hàng & chọn phương thức thanh toán -->
                <div class="col-md-12 col-lg-6 col-xl-5">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Products</th>
                                    <th>Name</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <th scope="row">
                                            <div class="d-flex align-items-center mt-2">
                                                <img src="~/Client/Hinh/HangHoa/@item.Hinh" class="img-fluid rounded-circle" style="width: 90px; height: 90px;" alt="">
                                            </div>
                                        </th>
                                        <td class="py-5">@item.TenHH</td>
                                        <td class="py-5">@item.DonGia vnd</td>
                                        <td class="py-5">@item.SoLuong</td>
                                        <td class="py-5">@item.ThanhTien</td>
                                    </tr>
                                }
                                <tr>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td class="py-5"><p class="mb-0 text-dark py-3">Subtotal</p></td>
                                    <td class="py-5">
                                        <div class="py-3 border-bottom border-top">
                                            <p class="mb-0 text-dark">@Model.Sum(p => p.ThanhTien).ToString("#,##0.00")</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Chọn phương thức thanh toán -->
                    <div class="form-check text-start my-3">
                        <input type="radio" class="form-check-input" name="PhuongThucThanhToan" value="COD" id="codRadio" required>
                        <label class="form-check-label" for="codRadio">Cash on Delivery (COD)</label>
                    </div>

                    <div class="form-check text-start my-3">
                        <input type="radio" class="form-check-input" name="PhuongThucThanhToan" value="ChuyenKhoan" id="bankRadio" required>
                        <label class="form-check-label" for="bankRadio">Chuyển khoản (VNPAY)</label>
                    </div>

                    <div class="row g-4 text-center align-items-center justify-content-center pt-4">
                        <button type="submit" class="btn btn-primary w-100">Place Order</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    // Khi submit, JS tự set action dựa trên phương thức thanh toán
    document.getElementById("checkoutForm").addEventListener("submit", function(e){
        const cod = document.getElementById("codRadio");
        const bank = document.getElementById("bankRadio");

        if(cod.checked){
            this.action = '@Url.Action("ThanhToanCod", "ThanhToan")';
        } else if(bank.checked){
            this.action = '@Url.Action("ThanhToanVnpay", "ThanhToan")';
        }
    });
</script>
